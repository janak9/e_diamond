{% extends 'user/base.html' %}
{% block content %}
{% load static %}
    <!-- Start Products  -->
    <div class="products-box">
        <div class="container" style="max-width: 1250px;">
            <div class="row">
                <div class="col-lg-3 col-md-3 col-sm-12">
                    <div class='filter_list animated bounceInDown'>
                        <ul>
                            {% for category in main_category.category.all %}
                            <li class='filter_list_sub_menu'>
                                <input type="checkbox" id="category_{{ category.pk }}" name="category[]" value="{{ category.pk }}" />
                                <label for="category_{{ category.pk }}">{{ category.name }}</label><i class='fa fa-caret-down right'></i>
                                <ul>
                                    {% for sub_category in category.sub_category.all %}
                                    <li>
                                        <input type="checkbox" id="sub_category_{{ sub_category.pk }}" name="sub_category[]" value="{{ sub_category.pk }}" />
                                        <label for="sub_category_{{ sub_category.pk }}">{{ sub_category.name }}</label>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                <div class="col-lg-9 col-md-9 col-sm-12">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="title-all text-center">
                                <h1>Featured Products</h1>
                                <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed sit amet lacus enim.</p>
                            </div>
                        </div>
                    </div>
                    <div class="row special-list">
                        {% for row in products %}
                            {% if forloop.counter0 < 4 %}
                            <div class="col-lg-3 col-md-6 special-grid">
                                <div class="products-single fix">
                                    <div class="box-img-hover">
                                        <a href="{% url 'user:product-details' pk=row.pk %}">
                                        <img src="{{ row.images.first.src.url }}" class="img-fluid" alt="{{ row.title }}">
                                        </a>
                                        <div class="mask-icon">
                                            <ul>
                                                <li><a href="{% url 'user:product-details' pk=row.pk %}" data-toggle="tooltip" data-placement="right" title="View"><i class="fas fa-eye"></i></a></li>
                                                <li><a href="" data-toggle="tooltip" data-placement="right" title="Compare" onclick="add_compare('{{ row.pk }}', event)"><i class="fas fa-sync-alt"></i></a></li>
                                                <li><a href="" data-toggle="tooltip" data-placement="right" title="Add to Wishlist" onclick="add_wishlist('{{ row.pk }}', event)"><i class="far fa-heart"></i></a></li>
                                            </ul>
                                            <a class="cart" href="{% url 'user:cart' %}" onclick="add_cart('{{ row.pk }}', 1, event)">Add to Cart</a>
                                        </div>
                                    </div>
                                    <div class="why-text">
                                        <h4><a href="{% url 'user:product-details' pk=row.pk %}">{{ row.title }}</a></h4>
                                        <h5><i class="fas fa-rupee-sign"></i> {{ row.price }}</h5>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- End Products  -->

<script type="text/javascript">
    $('.filter_list_sub_menu ul').hide();
    $(".filter_list_sub_menu").click(function (event) {
        if (!($(event.target).hasClass('filter_list_sub_menu'))) return;
        $(this).children("ul").slideToggle("100");
        $(this).find(".right").toggleClass("fa-caret-up fa-caret-down");
    });

    $('input[type="checkbox"]').change(function(e) {
        var checked = $(this).prop("checked"),
            container = $(this).parent(),
            siblings = container.siblings();

        container.find('input[type="checkbox"]').prop({
            indeterminate: false,
            checked: checked
        });

        function checkSiblings(el) {
            var parent = el.parent().parent(),
                all = true;

            el.siblings().each(function() {
                let returnValue = all = ($(this).children('input[type="checkbox"]').prop("checked") === checked);
                return returnValue;
            });
            
            if (all && checked) {
                parent.children('input[type="checkbox"]').prop({
                    indeterminate: false,
                    checked: checked
                });
                checkSiblings(parent);
            } else if (all && !checked) {
                parent.children('input[type="checkbox"]').prop("checked", checked);
                parent.children('input[type="checkbox"]').prop("indeterminate", (parent.find('input[type="checkbox"]:checked').length > 0));
                checkSiblings(parent);
            } else {
                el.parents("li").children('input[type="checkbox"]').prop({
                    indeterminate: true,
                    checked: false
                });
            }
        }
        checkSiblings(container);
    });
</script>
{% endblock content %}